<deploymentModule category="Deployment" creation="2015-07-01 16:50:22.281 UTC" deleted="false" description="Deployment of the LAMP demo. Note: port 27017 must be opened in your cloud security group named default (IaaS level)" isLatestVersion="true" lastModified="2015-07-01 22:38:05.593 UTC" logoLink="https://slipstream.sixsq.com/images/modules-logos/lamp.jpg" parentUri="module/apps/LAMP" shortName="lamp-deployment" version="1736">
   <authz groupCreateChildren="false" groupDelete="false" groupGet="true" groupPost="true" groupPut="true" inheritedGroupMembers="true" owner="sixsq" ownerCreateChildren="true" ownerDelete="true" ownerGet="true" ownerPost="true" ownerPut="true" publicCreateChildren="false" publicDelete="false" publicGet="true" publicPost="true" publicPut="false">
      <groupMembers>
         </groupMembers>
   </authz>
   <commit author="sixsq">
      <comment>Initial version of this module</comment>
   </commit>
   <published publicationDate="2015-07-01 22:38:05.593 UTC" />
   <cloudNames length="12">
      </cloudNames>
   <runs count="3" limit="20" offset="0" totalCount="3">
      </runs>
   <nodes>
      <entry>
         <string>web</string>
         <node cloudService="default" creation="2015-07-01 16:50:22.281 UTC" deleted="false" imageUri="module/apps/LAMP/apache-php" maxProvisioningFailures="0" multiplicity="2" name="web" network="Public">
            <parameterMappings>
               <entry>
                  <string>isReplicaSetReady</string>
                  <parameter category="General" description="" isMappedValue="true" mandatory="false" name="isReplicaSetReady" order="0" order_="0" readonly="false" type="String">
                     <value>db:isReplicaSetReady</value>
                  </parameter>
               </entry>
               <entry>
                  <string>replicaSetConf</string>
                  <parameter category="General" description="" isMappedValue="true" mandatory="false" name="replicaSetConf" order="0" order_="0" readonly="false" type="String">
                     <value>db:replicaSetConf</value>
                  </parameter>
               </entry>
            </parameterMappings>
            <parameters>
               <entry>
                  <string>isReplicaSetReady</string>
                  <parameter category="General" description="" isMappedValue="true" mandatory="false" name="isReplicaSetReady" order="0" order_="0" readonly="false" type="String">
                     <value>db:isReplicaSetReady</value>
                  </parameter>
               </entry>
               <entry>
                  <string>replicaSetConf</string>
                  <parameter category="General" description="" isMappedValue="true" mandatory="false" name="replicaSetConf" order="0" order_="0" readonly="false" type="String">
                     <value>db:replicaSetConf</value>
                  </parameter>
               </entry>
            </parameters>
            <image category="Image" creation="2014-06-16 11:19:42.517 UTC" deleted="false" description="Apache2/PHP layer. Includes a simple read/write app running on port 80" isBase="false" isLatestVersion="true" lastModified="2015-07-01 21:11:23.351 UTC" loginUser="ubuntu" logoLink="https://slipstream.sixsq.com/images/modules-logos/php.svg" moduleReferenceUri="module/examples/images/ubuntu-12.04" name="apps/LAMP/apache-php" parentUri="module/apps/LAMP" platform="ubuntu" shortName="apache-php" version="1756">
               <authz groupCreateChildren="false" groupDelete="false" groupGet="true" groupPost="false" groupPut="true" inheritedGroupMembers="true" owner="sixsq" ownerCreateChildren="true" ownerDelete="true" ownerGet="true" ownerPost="true" ownerPut="true" publicCreateChildren="false" publicDelete="false" publicGet="true" publicPost="false" publicPut="false">
                  <groupMembers>
                     <string>anis</string>
                     <string>konstan</string>
                     <string>lionel</string>
                     <string>loomis</string>
                     <string>meb</string>
                     <string>rob</string>
                     <string>stef</string>
                  </groupMembers>
               </authz>
               <commit author="lionel">
                  <comment>Added the function ss-display into Image Creation Recipes</comment>
               </commit>
               <targets>
                  <target name="report" />
                  <target name="onvmadd" />
                  <target name="onvmremove" />
                  <target name="execute">#!/bin/sh -xe


#cat &gt;&gt; /etc/apache2/httpd.conf &lt;&lt; 'EOF'
#LoadModule php5_module modules/libphp5.so
#
#&lt;FilesMatch \.php$&gt;
#    SetHandler application/x-httpd-php
#&lt;/FilesMatch&gt;
#EOF


service apache2 stop
sed -i -e 's/;   extension=msql.so/extension=mongo.so/' /etc/php5/apache2/php.ini

# wait for the cluster to be ready
ss-display "Waiting for the mongo cluster to be ready"
ss-get --timeout 3600 isReplicaSetReady

# TODO remove when replicaSet is guaranteed to be ready at the time of setting isReplicaSetReady
#sleep 30

# get input parameters
replicaSetConf=$(ss-get --timeout 3600 replicaSetConf)
id=$(ss-get id)

replicaset=$(echo $replicaSetConf | sed 's/,/:27017,/g' | sed 's/$/:27017/')

# create php page to read entries
ss-display "Creating php pages"
cat &gt; /tmp/mongoRead.php &lt;&lt; 'EOF'
&lt;?php
$connection = new MongoClient("mongodb://__REPLICASET__/?replicaSet=rs0");
$db = $connection-&gt;test;
$collection = $db-&gt;testData;
$result = $db-&gt;command(array("isMaster" =&gt; 1));
$mongoserver = $result["me"];
$db-&gt;setReadPreference(MongoClient::RP_PRIMARY_PREFERRED);
$writers = array();
for ($i = 1; $i &lt;= $collection-&gt;count(); $i++) {
    $writers["writer-" . str_pad($i,2,"0", STR_PAD_LEFT)] = $collection-&gt;count(array('writer' =&gt; $i));
}
$arr = array();
$arr["db"] = $mongoserver;
$arr["writers"] = $writers;
header('Content-Type: application/json');
echo $_GET['callback'] . '('.json_encode($arr).')';
?&gt;
EOF

sed -i -e 's/__REPLICASET__/'$replicaset'/' /tmp/mongoRead.php

# create php page to write (insert entries)
cat &gt; /tmp/mongoWrite.php &lt;&lt; 'EOF'
&lt;?php
$connection = new MongoClient("mongodb://__REPLICASET__/?replicaSet=rs0");
$db = $connection-&gt;test;
$collection = $db-&gt;testData;
$result = $db-&gt;command(array("isMaster" =&gt; 1));
$mongoserver = $result["me"];
$doc = array(
    "x" =&gt; $_REQUEST['value'],
    "writer" =&gt; __ID__,
    "mongo" =&gt; $mongoserver
);
$collection-&gt;insert($doc, array("w" =&gt; 2));
header('Content-Type: application/json');
echo $_GET['callback'] . '('.json_encode(array("db" =&gt; $mongoserver)).')';
?&gt;
EOF

sed -i -e 's/__REPLICASET__/'$replicaset'/' /tmp/mongoWrite.php
sed -i -e 's/__ID__/'$id'/' /tmp/mongoWrite.php

cp /tmp/mongo*php /var/www/

ss-display "Installing Lamp++ UI"

cd /var/www
wget https://github.com/slipstream/slipstream-lamp-ui/releases/download/1.0/lamp-ui.tgz
tar zxvf lamp-ui.tgz

service apache2 start
ss-set ready true
URL=http://$(ss-get hostname)
ss-set url.service $URL
ss-display "ApachePHP ready"
</target>
               </targets>
               <packages />
               <prerecipe />
               <recipe>#!/bin/bash -xe

function ss-display {
    $(which ss-display) "$1" || echo "$1"
}

ss-display "Updating Ubuntu mirror location"
cat &gt;&gt; /tmp/mirrors.txt &lt;&lt; 'EOF'
deb mirror://mirrors.ubuntu.com/mirrors.txt precise main restricted universe multiverse
deb mirror://mirrors.ubuntu.com/mirrors.txt precise-updates main restricted universe multiverse
deb mirror://mirrors.ubuntu.com/mirrors.txt precise-backports main restricted universe multiverse
deb mirror://mirrors.ubuntu.com/mirrors.txt precise-security main restricted universe multiverse
EOF

cat /tmp/mirrors.txt | cat - /etc/apt/sources.list &gt; /tmp/sources.list
cp -f /tmp/sources.list  /etc/apt/sources.list

# increasing the apt cache size so it works
echo "APT::Cache-Limit \"50331648\"\;" &gt;&gt;  /etc/apt/apt.conf.d/70debconf



# Install apache and php
apt-get update -y
apt-get install -y apache2
apt-get install -y make
apt-get install -y php5-common libapache2-mod-php5 php5-cli php5-dev php-pear
apt-get install -y expect



# Install php driver for mongo
#/usr/bin/expect -c 'spawn pear install -f pecl/mongo ; expect "Build with Cyrus SASL (MongoDB Enterprise Authentication) support?" ; send -- "\r" ; expect "Build process completed successfully"; expect eof'
yes '' | pecl install -f mongo</recipe>
               <cloudImageIdentifiers />
               <parameters>
                  <entry>
                     <string>ultimum-cz1.instance.type</string>
                     <parameter category="ultimum-cz1" description="Instance type (flavor)" isSet="true" mandatory="true" name="ultimum-cz1.instance.type" order="0" order_="0" readonly="false" type="String">
                        <value>Basic</value>
                        <defaultValue>Basic</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-ap-southeast-2.instance.type</string>
                     <parameter category="ec2-ap-southeast-2" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-ap-southeast-2.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-sa-east-1.security.groups</string>
                     <parameter category="ec2-sa-east-1" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-sa-east-1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>network</string>
                     <parameter category="Cloud" description="Network type" isSet="true" mandatory="true" name="network" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="2">
                           <string>Public</string>
                           <string>Private</string>
                        </enumValues>
                        <value>Public</value>
                        <defaultValue>Public</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-ap-southeast-1.security.groups</string>
                     <parameter category="ec2-ap-southeast-1" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-ap-southeast-1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>hostname</string>
                     <parameter category="Output" description="hostname/ip of the image" isSet="false" mandatory="true" name="hostname" order="0" order_="0" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>ready</string>
                     <parameter category="Output" description="Web layer ready?" isSet="false" mandatory="false" name="ready" order="0" order_="0" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>ec2-us-east-1.instance.type</string>
                     <parameter category="ec2-us-east-1" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-us-east-1.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-us-east-1.security.groups</string>
                     <parameter category="ec2-us-east-1" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-us-east-1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-us-west-1.instance.type</string>
                     <parameter category="ec2-us-west-1" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-us-west-1.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>replicaSetConf</string>
                     <parameter category="Input" description="Database cluster configuration" isSet="false" mandatory="false" name="replicaSetConf" order="0" order_="0" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>ec2-eu-west.instance.type</string>
                     <parameter category="ec2-eu-west" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-eu-west.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-us-west-1.security.groups</string>
                     <parameter category="ec2-us-west-1" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-us-west-1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-ap-northeast-1.instance.type</string>
                     <parameter category="ec2-ap-northeast-1" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-ap-northeast-1.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-ap-southeast-2.security.groups</string>
                     <parameter category="ec2-ap-southeast-2" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-ap-southeast-2.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>exoscale-ch-gva.instance.type</string>
                     <parameter category="exoscale-ch-gva" description="Instance type (flavor)" isSet="true" mandatory="true" name="exoscale-ch-gva.instance.type" order="0" order_="0" readonly="false" type="String">
                        <value>Micro</value>
                        <defaultValue>Micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-ap-southeast-1.instance.type</string>
                     <parameter category="ec2-ap-southeast-1" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-ap-southeast-1.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>exoscale-ch-gva.security.groups</string>
                     <parameter category="exoscale-ch-gva" description="Security Groups (comma separated list)" isSet="true" mandatory="true" name="exoscale-ch-gva.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-sa-east-1.instance.type</string>
                     <parameter category="ec2-sa-east-1" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-sa-east-1.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-eu-west.security.groups</string>
                     <parameter category="ec2-eu-west" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-eu-west.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>extra.disk.volatile</string>
                     <parameter category="Cloud" description="Volatile extra disk in GB" isSet="true" mandatory="true" name="extra.disk.volatile" order="0" order_="0" readonly="false" type="String">
                        <value>5</value>
                        <defaultValue>5</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>isReplicaSetReady</string>
                     <parameter category="Input" description="Is the database fully ready (including replica cluster)?" isSet="false" mandatory="false" name="isReplicaSetReady" order="0" order_="0" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>instanceid</string>
                     <parameter category="Output" description="Cloud instance id" isSet="false" mandatory="true" name="instanceid" order="0" order_="0" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>ec2-eu-central-1.security.groups</string>
                     <parameter category="ec2-eu-central-1" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-eu-central-1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-eu-central-1.instance.type</string>
                     <parameter category="ec2-eu-central-1" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-eu-central-1.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-us-west-2.security.groups</string>
                     <parameter category="ec2-us-west-2" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-us-west-2.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ultimum-cz1.security.groups</string>
                     <parameter category="ultimum-cz1" description="Security Groups (comma separated list)" isSet="true" mandatory="true" name="ultimum-cz1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-ap-northeast-1.security.groups</string>
                     <parameter category="ec2-ap-northeast-1" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-ap-northeast-1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-us-west-2.instance.type</string>
                     <parameter category="ec2-us-west-2" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-us-west-2.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
               </parameters>
               <notes length="0" />
            </image>
            <notes length="0" />
         </node>
      </entry>
      <entry>
         <string>lb</string>
         <node cloudService="default" creation="2015-07-01 16:50:22.281 UTC" deleted="false" imageUri="module/apps/LAMP/haproxy" maxProvisioningFailures="0" multiplicity="1" name="lb" network="Public">
            <parameterMappings>
               <entry>
                  <string>web_nodename</string>
                  <parameter category="General" description="" isMappedValue="false" mandatory="false" name="web_nodename" order="0" order_="0" readonly="false" type="String">
                     <value>'web'</value>
                  </parameter>
               </entry>
            </parameterMappings>
            <parameters>
               <entry>
                  <string>web_nodename</string>
                  <parameter category="General" description="" isMappedValue="false" mandatory="false" name="web_nodename" order="0" order_="0" readonly="false" type="String">
                     <value>'web'</value>
                  </parameter>
               </entry>
            </parameters>
            <image category="Image" creation="2014-06-16 11:16:46.441 UTC" deleted="false" description="HAProxy configured for load balancing (no HA setup)" isBase="false" isLatestVersion="true" lastModified="2015-07-01 21:11:29.149 UTC" loginUser="ubuntu" logoLink="https://slipstream.sixsq.com/images/modules-logos/haproxy.png" moduleReferenceUri="module/examples/images/ubuntu-12.04" name="apps/LAMP/haproxy" parentUri="module/apps/LAMP" platform="ubuntu" shortName="haproxy" version="1757">
               <authz groupCreateChildren="false" groupDelete="false" groupGet="true" groupPost="false" groupPut="true" inheritedGroupMembers="true" owner="sixsq" ownerCreateChildren="true" ownerDelete="true" ownerGet="true" ownerPost="true" ownerPut="true" publicCreateChildren="false" publicDelete="false" publicGet="true" publicPost="false" publicPut="false">
                  <groupMembers>
                     <string>anis</string>
                     <string>konstan</string>
                     <string>lionel</string>
                     <string>loomis</string>
                     <string>meb</string>
                     <string>rob</string>
                     <string>stef</string>
                  </groupMembers>
               </authz>
               <commit author="lionel">
                  <comment>Added the function ss-display into Image Creation Recipes</comment>
               </commit>
               <targets>
                  <target name="onvmremove" />
                  <target name="onvmadd" />
                  <target name="execute">#!/bin/bash -xe



cp /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg_orig
cat /dev/null &gt; /etc/haproxy/haproxy.cfg
cat &gt;&gt;  /etc/haproxy/haproxy.cfg &lt;&lt; 'EOF'

global
        log 127.0.0.1   local0
        log 127.0.0.1   local1 notice
        #log loghost    local0 info
        maxconn 4096
        #debug
        #quiet
        user haproxy
        group haproxy

defaults
        log     global
        mode    http
        option  httplog
        option  dontlognull
        retries 3
        option redispatch
        maxconn 2000
        contimeout      5000
        clitimeout      50000
        srvtimeout      50000

listen webfarm :80
       mode http
       stats enable
       stats auth someuser:somepassword
       balance roundrobin
       cookie JSESSIONID prefix
       option httpclose
       option forwardfor
       option httpchk HEAD / HTTP/1.0
EOF

##sed -i s/%VIRTUALIP%/$VIRTUALIP/ /etc/haproxy/haproxy.cfg
# add the config line from each of the webservers, wait for the apache servers first

# ::: recover and set HAPROXY info

ss-display "Waiting for the nodename and id from apache servers"

APACHE_NODENAME=$(ss-get --timeout 360 web_nodename)
APACHE_IDS=$(ss-get $APACHE_NODENAME:ids)
#HAPROXY_NODE=$(ss-get nodename)
#HAPROXY_INDEX=$(ss-get index)


# gather info from all the other apache nodes 

for i in ${APACHE_IDS//,/ };
 do   
    ss-display "Waiting for ${i}th Apache node: $APACHE_NODENAME.${i}:hostname"
    WN_IP=$(ss-get --timeout 360 $APACHE_NODENAME.${i}:hostname)
    WN_READINESS=$(ss-get --timeout 600 $APACHE_NODENAME.${i}:ready)
    WN_HOSTNAME=${APACHE_NODENAME}${i}
    
    WN_HOSTNAMES="$WN_HOSTNAMES,$WN_IP"
    COOKIE=$(echo $((64 + i)) |awk '{printf "%c\n", $1}') 
    echo "  server web$COOKIE ${WN_IP}:80 cookie $COOKIE check" &gt;&gt; /etc/haproxy/haproxy.cfg
 
    
done 

sed -i s/ENABLED=0/ENABLED=1/ /etc/default/haproxy

# # enable HA in the service (vs. only balancing)
# 
# sed -i s/ENABLED=0/ENABLED=1/ /etc/default/haproxy
# 
# 
# # ::: Keepalived :::
# ss-display "Installing keepalived"
# apt-get -y install keepalived
# 
# cat &gt;&gt; /etc/sysctl.d/60-keepalived.conf &lt;&lt; 'EOF'
# net.ipv4.ip_nonlocal_bind=1
# EOF
# ss-display "Restarting sysctl.."
# service procps start
# 
# cat &gt;&gt; /etc/keepalived/keepalived.conf &lt;&lt; 'EOF'
# 
# vrrp_script chk_haproxy {           # Requires keepalived-1.1.13
#         script "killall -0 haproxy"     # cheaper than pidof
#         interval 2                      # check every 2 seconds
#         weight 2                        # add 2 points of prio if OK
# }
# 
# vrrp_instance VI_1 {
#         interface eth0
#         state MASTER
#         virtual_router_id 77
#         priority %PRIORITY%                    # 101 on master, 100 on backup
#         virtual_ipaddress {
#             %VIRTUALIP%
#         }
#         track_script {
#             chk_haproxy
#         }
# }
# 
# EOF
# 
# 
# 
# # 1st node is always the master, we decrement priority for all others
# PRIORITY=$((102-HAPROXY_INDEX))
# ss-display "Replace Virtual IP to $VIRTUALIP for keepalived and set priority to $PRIORITY"
# 
# sed -i s/%PRIORITY%/$PRIORITY/ /etc/keepalived/keepalived.conf 
# sed -i s/%VIRTUALIP%/$VIRTUALIP/ /etc/keepalived/keepalived.conf 
# ss-display "Starting keepalived"
# service keepalived start	

IPSTATUS=$(ip addr sh eth0)

ss-display "Starting HAProxy with IP status $IPSTATUS"
service haproxy start
#ss-display "Started HAProxy. Should be ready on the port $VIRTUALIP"

#ss-set apacheserverip $VIRTUALIP

URL=http://$(ss-get hostname)
ss-set url.service $URL
ss-set ss:url.service $URL

ss-set ready true
</target>
                  <target name="report" />
               </targets>
               <packages />
               <prerecipe />
               <recipe>#!/bin/bash -xe

function ss-display {
    $(which ss-display) "$1" || echo "$1"
}

# create a data filesystem for DB
ss-display "Updating Ubuntu mirror location"
cat &gt;&gt; /tmp/mirrors.txt &lt;&lt; 'EOF'
deb mirror://mirrors.ubuntu.com/mirrors.txt precise main restricted universe multiverse
deb mirror://mirrors.ubuntu.com/mirrors.txt precise-updates main restricted universe multiverse
deb mirror://mirrors.ubuntu.com/mirrors.txt precise-backports main restricted universe multiverse
deb mirror://mirrors.ubuntu.com/mirrors.txt precise-security main restricted universe multiverse
EOF

cat /tmp/mirrors.txt | cat - /etc/apt/sources.list &gt; /tmp/sources.list
cp -f /tmp/sources.list  /etc/apt/sources.list


#increasing the apt cache size so it works
echo "APT::Cache-Limit \"50331648\"\;" &gt;&gt;  /etc/apt/apt.conf.d/70debconf 

apt-get update -y


# retrieve the IPs of the web backend



# if master, retrieve the stolen last free IP for virtual IP from the subnet 
##ss-display "Installing fping"
##apt-get -y install fping

##MYIP=$(ifconfig eth0 | grep 'inet addr' | awk  'BEGIN{FS="[: ]+"}{print $4}');
##MYSUB=$(echo $MYIP | awk -F \. '{print $1"."$2"."$3".0/24";}')

##ss-display "Retrieving unassigned IP from the subnet.."
#VIRTUALIP=$(fping -g $MYSUB 2&gt;/dev/null | grep 'is unreachable' | cut -d ' ' -f 1 | sort -t '.' -k 4 -n | tail -n 2 | head -n 1)
#VIRTUALIP=$(ss-get --timeout 360 donatedIP)

#::: HAProxy :::
# install haproxy

#ss-display "Installing haproxy with IP $MYIP and virtual IP: $VIRTUALIP"
ss-display "Installing haproxy"
apt-get -y install haproxy
</recipe>
               <cloudImageIdentifiers />
               <parameters>
                  <entry>
                     <string>ultimum-cz1.instance.type</string>
                     <parameter category="ultimum-cz1" description="Instance type (flavor)" isSet="true" mandatory="true" name="ultimum-cz1.instance.type" order="0" order_="0" readonly="false" type="String">
                        <value>Basic</value>
                        <defaultValue>Basic</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-ap-southeast-2.instance.type</string>
                     <parameter category="ec2-ap-southeast-2" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-ap-southeast-2.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-sa-east-1.security.groups</string>
                     <parameter category="ec2-sa-east-1" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-sa-east-1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>network</string>
                     <parameter category="Cloud" description="Network type" isSet="true" mandatory="true" name="network" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="2">
                           <string>Public</string>
                           <string>Private</string>
                        </enumValues>
                        <value>Public</value>
                        <defaultValue>Public</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-ap-southeast-1.security.groups</string>
                     <parameter category="ec2-ap-southeast-1" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-ap-southeast-1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>hostname</string>
                     <parameter category="Output" description="hostname/ip of the image" isSet="false" mandatory="true" name="hostname" order="0" order_="0" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>web_nodename</string>
                     <parameter category="Input" description="Nodename of the web node" isSet="false" mandatory="false" name="web_nodename" order="0" order_="0" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>ready</string>
                     <parameter category="Output" description="HAProxy ready to load balance" isSet="false" mandatory="false" name="ready" order="0" order_="0" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>ec2-us-east-1.instance.type</string>
                     <parameter category="ec2-us-east-1" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-us-east-1.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-us-east-1.security.groups</string>
                     <parameter category="ec2-us-east-1" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-us-east-1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-us-west-1.instance.type</string>
                     <parameter category="ec2-us-west-1" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-us-west-1.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-eu-west.instance.type</string>
                     <parameter category="ec2-eu-west" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-eu-west.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-us-west-1.security.groups</string>
                     <parameter category="ec2-us-west-1" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-us-west-1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-ap-northeast-1.instance.type</string>
                     <parameter category="ec2-ap-northeast-1" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-ap-northeast-1.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-ap-southeast-2.security.groups</string>
                     <parameter category="ec2-ap-southeast-2" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-ap-southeast-2.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>exoscale-ch-gva.instance.type</string>
                     <parameter category="exoscale-ch-gva" description="Instance type (flavor)" isSet="true" mandatory="true" name="exoscale-ch-gva.instance.type" order="0" order_="0" readonly="false" type="String">
                        <value>Micro</value>
                        <defaultValue>Micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-ap-southeast-1.instance.type</string>
                     <parameter category="ec2-ap-southeast-1" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-ap-southeast-1.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>exoscale-ch-gva.security.groups</string>
                     <parameter category="exoscale-ch-gva" description="Security Groups (comma separated list)" isSet="true" mandatory="true" name="exoscale-ch-gva.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-sa-east-1.instance.type</string>
                     <parameter category="ec2-sa-east-1" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-sa-east-1.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-eu-west.security.groups</string>
                     <parameter category="ec2-eu-west" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-eu-west.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>extra.disk.volatile</string>
                     <parameter category="Cloud" description="Volatile extra disk in GB" isSet="false" mandatory="true" name="extra.disk.volatile" order="0" order_="0" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>instanceid</string>
                     <parameter category="Output" description="Cloud instance id" isSet="false" mandatory="true" name="instanceid" order="0" order_="0" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>ec2-eu-central-1.security.groups</string>
                     <parameter category="ec2-eu-central-1" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-eu-central-1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-eu-central-1.instance.type</string>
                     <parameter category="ec2-eu-central-1" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-eu-central-1.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-us-west-2.security.groups</string>
                     <parameter category="ec2-us-west-2" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-us-west-2.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ultimum-cz1.security.groups</string>
                     <parameter category="ultimum-cz1" description="Security Groups (comma separated list)" isSet="true" mandatory="true" name="ultimum-cz1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-ap-northeast-1.security.groups</string>
                     <parameter category="ec2-ap-northeast-1" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-ap-northeast-1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-us-west-2.instance.type</string>
                     <parameter category="ec2-us-west-2" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-us-west-2.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
               </parameters>
               <notes length="0" />
            </image>
            <notes length="0" />
         </node>
      </entry>
      <entry>
         <string>db</string>
         <node cloudService="default" creation="2015-07-01 16:50:22.281 UTC" deleted="false" imageUri="module/apps/MongoDB/mongodb" maxProvisioningFailures="0" multiplicity="3" name="db" network="Public">
            <parameterMappings />
            <parameters />
            <image category="Image" creation="2014-06-16 11:15:38.633 UTC" deleted="false" description="MongoDB image for cluster deployment. Sets-up by default a majority replication scheme." isBase="false" isLatestVersion="true" lastModified="2015-07-01 21:11:34.961 UTC" loginUser="ubuntu" logoLink="https://slipstream.sixsq.com/images/modules-logos/mongodb.svg" moduleReferenceUri="module/examples/images/ubuntu-12.04" name="apps/MongoDB/mongodb" parentUri="module/apps/MongoDB" platform="ubuntu" shortName="mongodb" version="1758">
               <authz groupCreateChildren="false" groupDelete="false" groupGet="true" groupPost="false" groupPut="true" inheritedGroupMembers="true" owner="sixsq" ownerCreateChildren="true" ownerDelete="true" ownerGet="true" ownerPost="true" ownerPut="true" publicCreateChildren="false" publicDelete="false" publicGet="true" publicPost="false" publicPut="false">
                  <groupMembers>
                     <string>anis</string>
                     <string>konstan</string>
                     <string>lionel</string>
                     <string>loomis</string>
                     <string>meb</string>
                     <string>rob</string>
                     <string>stef</string>
                  </groupMembers>
               </authz>
               <commit author="lionel">
                  <comment>Added the function ss-display into Image Creation Recipes</comment>
               </commit>
               <targets>
                  <target name="onvmremove" />
                  <target name="report" />
                  <target name="onvmadd" />
                  <target name="execute">#!/bin/bash -xe


function waitForReplicaSet(){

retries=100
MONGO_REPLICA_RESULT="NOTREADY"
while [[ $MONGO_REPLICA_RESULT != 'READY' ]] &amp;&amp; [[ $retries -ne 0 ]]
do
MONGO_REPLICA_RESULT=$(mongo --quiet /tmp/replicaInit.js | awk 'BEGIN{FS=":"}{print $1;}')
ss-display "Got response from replicaSet: $MONGO_REPLICA_RESULT."
sleep 5
if [[  $MONGO_REPLICA_RESULT != 'READY' ]]
then
ss-display "Sleeping more $retries time..."
fi
(( retries-- ))


done

return 0;
}


#Initialize pyMongo
function pymongo_instal(){
# Install easy_install
wget https://bitbucket.org/pypa/setuptools/raw/0.7.7/ez_setup.py -O - | python
# Install python driver for mongo
/usr/local/bin/easy_install pymongo
}





# stop the DB, provide the proper configuration file: different for the master, different for the slaves or choose a replica set node belongs to 
# make sure the server is accessible from the other nodes
mkdir -p /data/mongodb
chown -R mongodb:mongodb /data/mongodb

# journaling space &gt;= RAM in mongo
mkdir -p /data/mongodb/log
chown -R mongodb:mongodb  /data/mongodb/log

# create the config file and start the service


cat &gt;   /etc/mongodb.conf  &lt;&lt; 'EOF'

# mongodb.conf

smallfiles=true

# Where to store the data.

# Note: if you run mongodb as a non-root user (recommended) you may
# need to create and set permissions for this directory manually,
# e.g., if the parent directory isn't mutable by the mongodb user.
dbpath=/data/mongodb

#daemonize 
fork=true

#where to log
logpath=/data/mongodb/mongodb.log

logappend=true
quiet = false

#port = 27017

#replica set
replSet = rs0

# Disables write-ahead journaling
# nojournal = true

# Enables periodic logging of CPU utilization and I/O wait
cpu = true

# Turn on/off security.  Off is currently the default
#noauth = true
#auth = true

# Verbose logging output.
verbose = true


EOF


# When logging-in, we need to set local
# This is not required when SlipStream executes the script
export LC_ALL=C

#starts the server as a daemon
#mongod --config /etc/mongodb.conf
service mongodb start
sleep 5

ss-set isMongoReady true

ss-display "Mongo server is ready to use"

# for each of the nodes, initialize replica set by adding slaves to the primary.
# The primary is a node with an "id" 1. 
# it waits until all other instances are propagated until all "ids" have been
# processed


# ::: Recover Mongo info
MONGO_ID=$(ss-get id)

MONGO_NODENAME=$(ss-get nodename)
MONGO_IDS=$(ss-get ids)

if [ "$MONGO_ID" = "1" ]
then
# gather info from all the other nodes and initialize the replica set

cat &gt; /tmp/replicaInit.js &lt;&lt; 'EOF'
var statusInit = rs.initiate({_id: "rs0", members: [
EOF

for i in ${MONGO_IDS//,/ };
do   
ss-display "Waiting for ${i}th node: ${MONGO_NODENAME}.${i}:hostname"
WN_IP=$(ss-get --timeout 360 ${MONGO_NODENAME}.${i}:hostname)
WN_READINESS=$(ss-get --timeout 600 ${MONGO_NODENAME}.${i}:isMongoReady)
WN_HOSTNAME=${MONGO_NODENAME}${i}

WN_HOSTNAMES="$WN_HOSTNAMES,$WN_IP"

echo "{_id: ${i}, host: \"${WN_IP}\" }, " &gt;&gt;  /tmp/replicaInit.js

done

#remove last comma
sed -i '$s/,$//' /tmp/replicaInit.js
WN_HOSTNAMES=$(echo $WN_HOSTNAMES | sed -e '$s/^,//')

#close the replica definition
cat &gt;&gt; /tmp/replicaInit.js &lt;&lt; 'EOF'
]});


var s=rs.status();

var numChecks = 0;
var replicaSetReady = true;

for (i in s.members)
{
var rsstate = s.members[i].state;
switch(rsstate) {
case 1:
case 2: //primary or secondary, ok, just leave
//print("Member "+ s.members[i].name + " is ready and is " + s.members[i].stateStr);
break;
case 0:
case 3:
case 5: // still initializing or recovering, increase the counter, wait and repeat
//print("Member "+ s.members[i].name + " is still initializing. Waiting for current status: "+s.members[i].stateStr);
numChecks++;
s=rs.status();
replicaSetReady=false;
//print("Got replicaSet status...");
//print("NOTREADY:"+"Member "+ s.members[i].name + " is still initializing. Waiting for current status: "+s.members[i].stateStr)


break;
default:
//print("ERROR:Severe error found, cannot continue. "+ s.members[i].name + " is :" + s.members[i].stateStr);
//error, just exit with error
replicaSetReady = false;
break;
}
}
//print("config : " + rs.conf());
if(replicaSetReady)print("READY:!"); else {print("NOTREADY")};

EOF

# create a replica set:

waitForReplicaSet
sleep 60
cat &gt;&gt; reconfigureReplica.js &lt;&lt; 'EOF'
cfg = rs.conf();
cfg.settings = {};
cfg.settings.getLastErrorDefaults = {w: "majority"};
var statusReConfig  = rs.reconfig(cfg);
EOF

mongo reconfigureReplica.js

waitForReplicaSet

# This comes from the fact Mongo lies about the replica state, it seems..
ss-display "Ensuring replica set is ready..."
sleep 90

MONGO_STATUS=$(mongo --quiet --eval "printjson(rs.status())")
MONGO_REPLICA_STATUS=$(mongo --eval "printjson(rs.conf())")
ss-display "Mongo status is: $MONGO_STATUS " 
ss-set replicaSetConf "\"$WN_HOSTNAMES\""
ss-set isReplicaSetReady true
ss-display "All set from the Primary node $MONGO_REPLICA_STATUS"
fi

</target>
               </targets>
               <packages />
               <prerecipe />
               <recipe>#!/bin/bash -xe

function ss-display {
    $(which ss-display) "$1" || echo "$1"
}

#Initialize pyMongo
function pymongo_instal(){
# Install easy_install
wget https://bitbucket.org/pypa/setuptools/raw/0.7.7/ez_setup.py -O - | python
# Install python driver for mongo
/usr/local/bin/easy_install pymongo
}


# create a data filesystem for DB
ss-display "Updating Ubuntu mirror location"
cat &gt;&gt; /tmp/mirrors.txt &lt;&lt; 'EOF'
deb mirror://mirrors.ubuntu.com/mirrors.txt precise main restricted universe multiverse
deb mirror://mirrors.ubuntu.com/mirrors.txt precise-updates main restricted universe multiverse
deb mirror://mirrors.ubuntu.com/mirrors.txt precise-backports main restricted universe multiverse
deb mirror://mirrors.ubuntu.com/mirrors.txt precise-security main restricted universe multiverse
EOF

cat /tmp/mirrors.txt | cat - /etc/apt/sources.list &gt; /tmp/sources.list
cp -f /tmp/sources.list  /etc/apt/sources.list

#increasing the apt cache size so it works
echo "APT::Cache-Limit \"50331648\"\;" &gt;&gt;  /etc/apt/apt.conf.d/70debconf 

#install mongo stuff
apt-key adv --keyserver keyserver.ubuntu.com --recv 7F0CEB10

#Create a /etc/apt/sources.list.d/10gen.list file using the following command.

echo 'deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen' | tee /etc/apt/sources.list.d/10gen.list


#Install Packages
#Issue the following command to install the latest stable version of MongoDB:
echo "Updating repos..."
apt-get update




#ss-display "Installing XFS tools"
#apt-get -y install xfsprogs

#ss-display "Getting info about the disk location/name based on the static drive size"

#EXTRA_DISK_SIZE_GB=$(ss-get extra.disk.volatile)
#EXTRA_DISK_SIZE_BYTES=$(($EXTRA_DISK_SIZE_GB*1024*1024))
#DATA_PARTITION=$(sfdisk -uM -sdqL 2&gt;/dev/null |  awk -- 'BEGIN { FS=":"} $2 ~ '$EXTRA_DISK_SIZE_BYTES' { print $1;}')

#ss-display "Creating data partitions"
#parted -s -a optimal -- $DATA_PARTITION mklabel gpt
#ss-display "Checking if there are any existing partitions and remove them"
#SPURIOS_PARTITIONS=$(parted -sm $DATA_PARTITION print | awk -- 'BEGIN{FS=":"} $1 ~ /[0-9]+/ {to_rem=to_rem" " $1}END{print to_rem;}')
#if [[ $SPURIOS_PARTITIONS ]] ; then 
#parted -s $DATA_PARTITION rm $SPURIOS_PARTITIONS
#fi
#parted -s -a optimal -- $DATA_PARTITION  unit compact mkpart  xfs "1" "-1" ;
#mkfs.xfs -q -f $DATA_PARTITION 
mkdir -p /data
#mount $DATA_PARTITION -o nobarrier,noatime,nodiratime,logbsize=262144,logbufs=0,allocsize=64M /data


#make some space for packages as the var is very small normally
ss-display "Moving reposiutory files to the new partition and linking it to /var."
mv -i /var/cache/apt /data
ln -s /data/apt /var/cache/apt


#ss-display "Setting mongoDB software on a disk $DATA_PARTITION"
ss-display "Setting mongoDB software on /data"


sudo apt-get -y install mongodb-10gen 
service mongodb stop || true</recipe>
               <cloudImageIdentifiers />
               <parameters>
                  <entry>
                     <string>ultimum-cz1.instance.type</string>
                     <parameter category="ultimum-cz1" description="Instance type (flavor)" isSet="true" mandatory="true" name="ultimum-cz1.instance.type" order="0" order_="0" readonly="false" type="String">
                        <value>Basic</value>
                        <defaultValue>Basic</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>isMongoReady</string>
                     <parameter category="Output" description="MongoDB ready to serve data?" isSet="false" mandatory="false" name="isMongoReady" order="0" order_="0" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>ec2-ap-southeast-2.instance.type</string>
                     <parameter category="ec2-ap-southeast-2" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-ap-southeast-2.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-sa-east-1.security.groups</string>
                     <parameter category="ec2-sa-east-1" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-sa-east-1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>network</string>
                     <parameter category="Cloud" description="Network type" isSet="true" mandatory="true" name="network" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="2">
                           <string>Public</string>
                           <string>Private</string>
                        </enumValues>
                        <value>Public</value>
                        <defaultValue>Public</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-ap-southeast-1.security.groups</string>
                     <parameter category="ec2-ap-southeast-1" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-ap-southeast-1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>hostname</string>
                     <parameter category="Output" description="hostname/ip of the image" isSet="false" mandatory="true" name="hostname" order="0" order_="0" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>ec2-us-east-1.instance.type</string>
                     <parameter category="ec2-us-east-1" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-us-east-1.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-us-east-1.security.groups</string>
                     <parameter category="ec2-us-east-1" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-us-east-1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-us-west-1.instance.type</string>
                     <parameter category="ec2-us-west-1" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-us-west-1.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>replicaSetConf</string>
                     <parameter category="Output" description="List of replica hostnames" isSet="false" mandatory="false" name="replicaSetConf" order="0" order_="0" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>ec2-eu-west.instance.type</string>
                     <parameter category="ec2-eu-west" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-eu-west.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-us-west-1.security.groups</string>
                     <parameter category="ec2-us-west-1" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-us-west-1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-ap-northeast-1.instance.type</string>
                     <parameter category="ec2-ap-northeast-1" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-ap-northeast-1.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-ap-southeast-2.security.groups</string>
                     <parameter category="ec2-ap-southeast-2" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-ap-southeast-2.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>exoscale-ch-gva.instance.type</string>
                     <parameter category="exoscale-ch-gva" description="Instance type (flavor)" isSet="true" mandatory="true" name="exoscale-ch-gva.instance.type" order="0" order_="0" readonly="false" type="String">
                        <value>Micro</value>
                        <defaultValue>Micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-ap-southeast-1.instance.type</string>
                     <parameter category="ec2-ap-southeast-1" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-ap-southeast-1.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>exoscale-ch-gva.security.groups</string>
                     <parameter category="exoscale-ch-gva" description="Security Groups (comma separated list)" isSet="true" mandatory="true" name="exoscale-ch-gva.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-sa-east-1.instance.type</string>
                     <parameter category="ec2-sa-east-1" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-sa-east-1.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-eu-west.security.groups</string>
                     <parameter category="ec2-eu-west" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-eu-west.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>extra.disk.volatile</string>
                     <parameter category="Cloud" description="Volatile extra disk in GB" isSet="false" mandatory="true" name="extra.disk.volatile" order="0" order_="0" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>isReplicaSetReady</string>
                     <parameter category="Output" description="MongoDB replica set ready?" isSet="false" mandatory="false" name="isReplicaSetReady" order="0" order_="0" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>instanceid</string>
                     <parameter category="Output" description="Cloud instance id" isSet="false" mandatory="true" name="instanceid" order="0" order_="0" readonly="false" type="String" />
                  </entry>
                  <entry>
                     <string>ec2-eu-central-1.security.groups</string>
                     <parameter category="ec2-eu-central-1" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-eu-central-1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-eu-central-1.instance.type</string>
                     <parameter category="ec2-eu-central-1" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-eu-central-1.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-us-west-2.security.groups</string>
                     <parameter category="ec2-us-west-2" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-us-west-2.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ultimum-cz1.security.groups</string>
                     <parameter category="ultimum-cz1" description="Security Groups (comma separated list)" isSet="true" mandatory="true" name="ultimum-cz1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-ap-northeast-1.security.groups</string>
                     <parameter category="ec2-ap-northeast-1" description="Security groups (comma separated list)" isSet="true" mandatory="true" name="ec2-ap-northeast-1.security.groups" order="0" order_="0" readonly="false" type="String">
                        <value>default</value>
                        <defaultValue>default</defaultValue>
                     </parameter>
                  </entry>
                  <entry>
                     <string>ec2-us-west-2.instance.type</string>
                     <parameter category="ec2-us-west-2" description="Cloud instance type" isSet="true" mandatory="true" name="ec2-us-west-2.instance.type" order="0" order_="0" readonly="false" type="Enum">
                        <enumValues length="32">
                           <string>t2.micro</string>
                           <string>t2.small</string>
                           <string>t2.medium</string>
                           <string>m3.medium</string>
                           <string>m3.large</string>
                           <string>m3.xlarge</string>
                           <string>m3.2xlarge</string>
                           <string>c4.large</string>
                           <string>c4.xlarge</string>
                           <string>c4.2xlarge</string>
                           <string>c4.4xlarge</string>
                           <string>c4.8xlarge</string>
                           <string>c3.large</string>
                           <string>c3.xlarge</string>
                           <string>c3.2xlarge</string>
                           <string>c3.4xlarge</string>
                           <string>c3.8xlarge</string>
                           <string>r3.large</string>
                           <string>r3.xlarge</string>
                           <string>r3.2xlarge</string>
                           <string>r3.4xlarge</string>
                           <string>r3.8xlarge</string>
                           <string>i2.xlarge</string>
                           <string>i2.2xlarge</string>
                           <string>i2.4xlarge</string>
                           <string>i2.8xlarge</string>
                           <string>d2.xlarge</string>
                           <string>d2.2xlarge</string>
                           <string>d2.4xlarge</string>
                           <string>d2.8xlarge</string>
                           <string>g2.2xlarge</string>
                           <string>g2.8xlarge</string>
                        </enumValues>
                        <value>t2.micro</value>
                        <defaultValue>t2.micro</defaultValue>
                     </parameter>
                  </entry>
               </parameters>
               <notes length="0" />
            </image>
            <notes length="0" />
         </node>
      </entry>
   </nodes>
   <parameters />
</deploymentModule>